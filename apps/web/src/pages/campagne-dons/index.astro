---
// ğŸ§± Components
import CheckoutFormWrapper from "./_components/CheckoutFormWrapper";
import ProgressBar from "./_components/ProgressBar";
import TitlePullUp from "./_components/TitlePullUp";

// ğŸ–¼ï¸ Layout
import BaseLayout from "@web/layout/BaseLayout/BaseLayout.astro";
import PageLayout from "@web/layout/PageLayout/PageLayout.astro";

// ğŸ”§ Libs
import { stripe } from "@/data-access/stripe";

export const prerender = false;
Astro.response.headers.set('Cache-Control', 's-maxage=3600, stale-while-revalidate');

// Compute percent in prohress for campaign
 let transactions: any[] = [];
  let has_more;
  let next_page;
  do {
    try {
      const resTransactions = (await stripe.charges.search({
        query: `metadata['campaign']:'dons-fin-2024' AND created>${(new Date("2024-11-07").getTime()) / 1000}`,
        limit: 100,
        ...(next_page ? { page: next_page } : {}),
      })) as any;
      next_page = resTransactions.next_page;
      if (has_more) next_page = resTransactions.next_page;
      transactions = [...transactions, ...resTransactions.data];
    } catch (e) {
      console.error("Error while fetching transactions for campaign", e);
    }
  } while (has_more);
  const total = transactions.filter(transaction => !transaction.invoice).reduce((acc, cv) => acc + (cv.amount/100) , 0)
  const MIN_VALUE = 5
  const progressInPercent = Math.max((Math.floor(total)/40000)*100, MIN_VALUE)
---

<BaseLayout
  title="Aidez Frustration Magazine Ã  grandir !"
  displayBanner={false}>
  <PageLayout>
    <!-- ğŸ…°ï¸ Titles -->
    <TitlePullUp
      client:load
      words="Twitch, nouveaux formats et international : 40 000â‚¬ pour nous aider"
      className="text-5xl text-black lg:text-7xl text-pretty text-center font-bold uppercase font-bebas"
    />
    <ProgressBar
      client:load
      value={progressInPercent}
      delayInSeconds={2}
      background="bg-yellow"
      className="h-10 mt-12 shadow-lg"
    />
    <!-- ğŸ”  Text -->
    <article class="mt-12 px-2 font-open-sans tracking-wide text-lg">
      <p class="text-center mb-11 text-xl">
        Frustration magazine câ€™est un mÃ©dia en ligne <b>100% gratuit</b>, <b
          >100% indÃ©pendant</b
        >, <b>sans publicitÃ© ni mÃ©cÃ¨ne</b>, qui dÃ©fend une <b
          >ligne radicale mais accessible</b
        >. Câ€™est aussi une revue papier annuelle disponible dans toutes les
        bonnes librairies.
      </p>
      <h3 class="font-bold text-center text-2xl mb-6">
        GrÃ¢ce Ã  vous en une seule annÃ©e nous avons :
      </h3>
      <ul
        class="text-base pl-6 xl:text-xl list-disc list-achievements space-y-4">
        <li>
          Produit de trÃ¨s nombreuses analyses, enquÃªtes et argumentaires pour
          mettre au jour la <b>rÃ©alitÃ© de la lutte des classes</b>, de la <b
            >domination coloniale</b
          > et des <b>mÃ©canismes patriarcaux</b> ;
        </li>
        <li>
          DÃ©veloppÃ© de <b>nouveaux formats vidÃ©os</b> (<i>Comprendre</i>, <i
            >Ã‰tat des lieux</i
          >, <i>Frustration Rencontres</i> etc.) ;
        </li>
        <li>
          RÃ©novÃ© entiÃ¨rement <b>nos rÃ©seaux sociaux</b> et tous nos <b
            >canaux de diffusion</b
          > pour les rendre plus agrÃ©ables et lisibles ;
        </li>
        <li>
          RenforcÃ© nos liens avec de <b>nombreux mÃ©dias indÃ©pendants alliÃ©s</b> (partenariat
          avec <i>Le MÃ©dia</i> pour l'Ã©mission <i>Coup de Griffe</i> par exemple)
          ;
        </li>
        <li>
          EnvoyÃ© des membres de notre Ã©quipe parler de la fin du capitalisme <b
            >dans des mÃ©dias <i>mainstream</i></b
          > ;
        </li>
      </ul>
      <h3 class="font-bold text-center text-2xl mt-16 mb-6">
        Et cela a payÃ© ! Puisque dans le mÃªme temps nous avons vu :
      </h3>
      <ul class="text-base pl-6 xl:text-xl list-disc space-y-4 list-results">
        <li>Le nombre de visiteurs sur notre site web multipliÃ© par 2 ;</li>
        <li>Notre nombre d'abonnÃ©s sur Instagram et Youtube doubler ;</li>
        <li>Notre newsletter passer le cap des 6 000 abonnÃ©s ;</li>
        <li>Notre audience se rajeunir et se fÃ©miniser.</li>
      </ul>
      <h3 class="font-bold text-center text-2xl mt-16 mb-6">
        Fort de ces succÃ¨s et actions, nous souhaitons continuer de nous
        dÃ©velopper en menant, en 2025, ces nouveaux projets :
      </h3>
      <ul class="text-base pl-6 xl:text-xl list-disc space-y-4 list-projects">
        <li>
          Une refonte complÃ¨te de notre site web qui intÃ¨grera <b
            >des contenus interactifs</b
          >
          pour faire dÃ©couvrir nos analyses comme des quiz, des contenus audios et
          vidÃ©os inÃ©dits, notre horoscope dÃ©calÃ© etc. ;
        </li>
        <li>
          <b>Agrandir encore notre Ã©quipe permanente</b> et accueillir <b
            >une plus grande diversitÃ© d'autrices et d'auteurs</b
          > pour couvrir encore plus de sujets qui nous tiennent Ã  cÅ“ur ;
        </li>
        <li>
          <b>AccÃ©lÃ©rer le mouvement d'internationalisation </b>de notre travail
          avec nos partenaires belges, britanniques et espagnols ;
        </li>
        <li>
          Lancer une <b
            >Ã©mission rÃ©guliÃ¨re de commentaire d'actualitÃ© sur Twitch</b
          >
          ;
        </li>
        <li>Offrir un <b>toilettage complet</b> Ã  Rob Grams.</li>
      </ul>
    </article>
    <TitlePullUp
      words="Twitch, nouveaux formats et international : 40 000â‚¬ pour nous aider"
      class="text-5xl text-black lg:text-7xl text-pretty text-center font-bold uppercase font-bebas"
    />
    <section class="mt-16 text-2xl text-center space-y-2">
      <p>
        Pour mener Ã  bien ces projets, nous souhaitons <b
          >rÃ©colter 40 000 euros en trois mois</b
        >.
      </p>
      <p>
        Vous aimez notre travail, vous voulez nous aider Ã  en faire plus ?
        <b>Vous pouvez donner la somme de votre choix !</b> MÃªme les plus petits
        montants sont utiles.
      </p>
    </section>
    <CheckoutFormWrapper client:only="react" />
  </PageLayout>
</BaseLayout>
<style>
  @counter-style results-counter {
    system: cyclic;
    symbols: "âœŒï¸" "ğŸ“ˆ" "ğŸ“¨" "ğŸ‘©â€ğŸ¤";
    suffix: "  ";
  }

  @counter-style achievements-counter {
    system: cyclic;
    symbols: "ğŸ–‹ï¸" "ğŸ¥" "#ï¸âƒ£" "ğŸ¤" "ğŸ§›" "ğŸ—¯ï¸" "ğŸ™…â€â™‚ï¸" "ğŸ‘Š";
    suffix: "  ";
  }

  @counter-style projects-counter {
    system: cyclic;
    symbols: "ğŸ¨" "ğŸ‘¯" "ğŸŒ" "ğŸ¤" "ğŸ¶";
    suffix: "  ";
  }

  .list-achievements {
    list-style: achievements-counter;
  }

  .list-results {
    list-style: results-counter;
  }

  .list-projects {
    list-style: projects-counter;
  }
</style>
